<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <title>Update Item</title>
</head>

<body>
    <topbar>
        <div class="top-bar-button">
            <a href="/dashboard" id="dash-button">
                <img src="https://cdn-icons-png.flaticon.com/512/25/25694.png" alt="dashboard" height="30">
            </a>
        </div>
        <div class="top-bar-button">
            <a href="/viewcart" id="cart-button">
                <img src="https://static.vecteezy.com/system/resources/previews/019/787/018/original/shopping-cart-icon-shopping-basket-on-transparent-background-free-png.png" alt="cart" height="30">
            </a>
        </div>
        <div class="top-bar-button">
            <a href="/login" id="logout-button">
                <img src="https://cdn0.iconfinder.com/data/icons/login-44/24/logout_doot_interface_essentials_login_regular_f-512.png" alt="log out" height="30">
            </a>
        </div>
        <div class="top-bar-button">
            <a href="/profile" id="profile-button">
                <img src="https://static-00.iconduck.com/assets.00/profile-icon-512x512-w0uaq4yr.png" alt="profile" height="30">
            </a>
        </div>
        {% if account['isadmin'] == 1%}
        <div class="top-bar-button">
            <a href="/debug" id="bug-button">
                <img src="https://static.thenounproject.com/png/83827-200.png" alt="debug" height="30">
            </a>
        </div>
        {% endif %}
    </topbar>
    <h1 id="update-header">Update Item</h1>
    <form id="updateForm">
        <label for="table">Select Table:</label>
        <select id="table" name="table">
            <option value="cpu">CPU</option>
            <option value="gpu">GPU</option>
            <option value="ram">RAM</option>
            <option value="mom">Motherboard</option>
            <option value="storage">Storage</option>
            <option value="psu">PSU</option>
            <option value="case">Case</option>
            <!-- Add other table options here -->
        </select>
    </form>

    <div id="tableContainer">
        <!-- Table will be populated dynamically -->
    </div>
    <span class="refresh-symbol" onclick="populateTable()">â†»</span>

    <!-- Overlay for update -->
    <div id="updateOverlay" class="overlay">
        <div class="overlay-content">
            <span class="close" onclick="closeOverlay()">&times;</span>
            <h2>Update Item</h2>
            <form id="updateItemForm" method="post">
                <!-- Input fields will be populated dynamically -->
            </form>
        </div>
    </div>

    <script>
        function populateTable() {
            var tableSelect = document.getElementById("table");
            var selectedTable = tableSelect.value;
            var tableContainer = document.getElementById("tableContainer");
            tableContainer.innerHTML = ""; // Clear previous table
            
            // Fetch data for the selected table using Flask route
            fetch(`/get_options/${selectedTable}`)
                .then(response => response.json())
                .then(data => {
                    // Create and populate the table
                    var table = document.createElement("table");
                    var headerRow = table.insertRow();
                    Object.keys(data[0]).forEach(key => {
                        var headerCell = headerRow.insertCell();
                        headerCell.textContent = key.charAt(0).toUpperCase() + key.slice(1);
                    });

                    data.forEach(item => {
                        var row = table.insertRow();
                        Object.values(item).forEach(value => {
                            var cell = row.insertCell();
                            cell.textContent = value;
                        });

                        // Add update button column
                        var updateCell = row.insertCell();
                        var updateButton = document.createElement("button");
                        updateButton.textContent = "Update";
                        updateButton.className = "update-button";
                        updateButton.onclick = function() {
                            openOverlay(selectedTable ,item); // Pass the item object to populate overlay
                        };
                        updateCell.appendChild(updateButton);
                    });

                    tableContainer.appendChild(table);
                })
                .catch(error => {
                    console.error('Error fetching table data:', error);
                });
        }

        function openOverlay(table, item) {
            var overlay = document.getElementById("updateOverlay");
            overlay.style.display = "block";
            var updateForm = document.getElementById("updateItemForm");
            updateForm.innerHTML = ""; // Clear previous form fields

            var tableInput = document.createElement("input");
            tableInput.type = "hidden";
            tableInput.name = "table";
            tableInput.value = table;
            updateForm.appendChild(tableInput);

            // Populate input fields based on item data
            for (const [key, value] of Object.entries(item)) {
                var label = document.createElement("label");
                label.textContent = key.charAt(0).toUpperCase() + key.slice(1);
                var input = document.createElement("input");
                input.type = "text";
                input.name = key;
                input.value = value;
                updateForm.appendChild(label);
                updateForm.appendChild(input);
                
            }
            var button = document.createElement('button');
            button.textContent = "Submit";
            button.type = "submit"; 
            updateForm.appendChild(button);

        }

        function closeOverlay() {
            var overlay = document.getElementById("updateOverlay");
            overlay.style.display = "none";
        }

        // Call populateTable initially to populate the table based on the default selected table
        populateTable();

        // Add event listener to re-populate table on table selection change
        document.getElementById("table").addEventListener("change", populateTable);
    </script>
</body>

</html>
